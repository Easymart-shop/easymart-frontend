<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>Login - EasyMart</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    .login-container {
      max-width: 400px; margin: auto; background: white; padding: 20px; border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input[type="text"], input[type="password"] {
      width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #ccc;
    }
    button {
      width: 100%; padding: 10px; background: #28a745; color: white; border: none; border-radius: 5px;
      cursor: pointer; font-size: 16px;
    }
    button:hover {
      background: #218838;
    }
    .register-link {
      margin-top: 15px; text-align: center;
    }
    .register-link a, .forgot-password {
      color: #007bff; cursor: pointer; text-decoration: none;
    }
    .register-link a:hover, .forgot-password:hover {
      text-decoration: underline;
    }
    .modal {
      display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%;
      overflow: auto; background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888;
      width: 300px; border-radius: 8px; text-align: center;
    }
    .close {
      color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;
    }
    .close:hover { color: black; }
    .modal input[type="text"] {
      width: 90%; padding: 8px; margin-top: 10px; border-radius: 4px; border: 1px solid #ccc;
    }
    .modal button {
      margin-top: 15px; padding: 8px 20px; background-color: #28a745; color: white;
      border: none; border-radius: 5px; cursor: pointer;
    }
    .modal button:hover {
      background-color: #218838;
    }
  </style>
</head>
<body>

  <div class="login-container">
    <h2>Login</h2>
    <form id="loginForm">
      <input type="text" id="emailOrPhone" placeholder="Phone number or Email" required />
      <input type="password" id="password" placeholder="Password" required />
      <button type="submit">Login</button>
    </form>

    <div style="margin-top:10px; text-align:right;">
      <span class="forgot-password">Forgot Password?</span>
    </div>

    <div class="register-link">
      Not registered? <a href="register.html">Registration Here</a>
    </div>
  </div>

  <!-- Forgot Password Modal -->
  <div id="forgotModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h3>Reset Password</h3>
      <input type="text" id="forgotEmailOrPhone" placeholder="Enter your Email or Phone" />
      <button id="resetPasswordBtn">Send Reset Link</button>
    </div>
  </div>

  <script>
    document.getElementById('loginForm').addEventListener('submit', function(e){
      e.preventDefault();

      const emailOrPhone = document.getElementById('emailOrPhone').value.trim();
      const password = document.getElementById('password').value;

      // ✅ Backend API call
      fetch('https://easymart-backend-4vh1.onrender.com/api/users/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email: emailOrPhone,  // ⚠️ এখন phone দিয়ে login করলে backend এ $or লাগবে
          password: password
        })
      })
      .then(res => res.json())
      .then(data => {
        if(data.user){
          localStorage.setItem('loggedInUser', JSON.stringify(data.user));
          alert("Login successful!");
          window.location.href = "account.html";
        } else {
          alert(data.message || "Login failed. Please check your credentials.");
        }
      })
      .catch(error => {
        console.error("Login error:", error);
        alert("Server error. Try again later.");
      });
    });

    // Forgot Password Modal control
    const modal = document.getElementById("forgotModal");
    const forgotLink = document.querySelector(".forgot-password");
    const closeBtn = document.querySelector(".close");

    forgotLink.onclick = () => modal.style.display = "block";
    closeBtn.onclick = () => modal.style.display = "none";
    window.onclick = function(event) {
      if (event.target == modal) modal.style.display = "none";
    };

    // Reset Password Button click
    document.getElementById("resetPasswordBtn").addEventListener("click", function(){
      const val = document.getElementById("forgotEmailOrPhone").value.trim();
      if(val === ""){
        alert("Please enter your Email or Phone.");
        return;
      }
      alert("Reset link sent to: " + val);
      modal.style.display = "none";
    });
  </script>

</body>
</html>
